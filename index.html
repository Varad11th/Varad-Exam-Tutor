<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>JEE PYQ Finder</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Add MathJax configuration and script -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>

    <style>
        /* Use Inter as the default font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a better dark-mode feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e1b2e;
        }
        ::-webkit-scrollbar-thumb {
            background: #6d28d9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5b21b6;
        }
        /* Simple spinner animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #c084fc;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-[#0f0c29] via-[#302b63] to-[#24243e] text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl mx-auto">
        
        <!-- Landing Page Section -->
        <section id="landing" class="text-center p-8 bg-black bg-opacity-30 backdrop-blur-lg rounded-2xl shadow-2xl border border-purple-800 border-opacity-30">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 text-purple-300">
                Varad's Exam Tutor
            </h1>
            <p class="text-lg md:text-xl text-gray-300 mb-12">
                Your dedicated tool for finding topic-wise Previous Year Questions for JEE Mains & Advanced.
            </p>

            <!-- New Feature Divs -->
            <div class="grid md:grid-cols-2 gap-6 text-left mb-12">
                <div class="bg-gray-900 bg-opacity-50 p-6 rounded-lg border border-purple-700">
                    <div class="flex items-center space-x-3 mb-3">
                        <!-- Icon: Target -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                        </svg>
                        <h3 class="text-xl font-semibold text-purple-300">Targeted Practice</h3>
                    </div>
                    <p class="text-gray-300">
                        Find questions for specific chapters and topics to strengthen your weak areas and build confidence.
                    </p>
                </div>
                <div class="bg-gray-900 bg-opacity-50 p-6 rounded-lg border border-purple-700">
                    <div class="flex items-center space-x-3 mb-3">
                        <!-- Icon: Fast Forward -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12.75 15l3-3m0 0l-3-3m3 3h-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="text-xl font-semibold text-purple-300">Simple & Fast</h3>
                    </div>
                    <p class="text-gray-300">
                        Get relevant PYQs in seconds with our simple, clean interface. No distractions, just focused learning.
                    </p>
                </div>
            </div>

            <!-- Moved Get Started Button -->
            <button id="get-started-btn" class="w-full sm:w-auto px-8 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50">
                Get Started
            </button>
        </section>

        <!-- Search Form Section -->
        <section id="search" class="hidden p-8 bg-black bg-opacity-30 backdrop-blur-lg rounded-2xl shadow-2xl border border-purple-800 border-opacity-30">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-purple-300">Find Questions</h2>
                <button id="back-to-landing-btn" class="text-sm text-purple-300 hover:text-purple-100">&larr; Back to Home</button>
            </div>
            
            <form id="search-form">
                <div class="space-y-6">
                    <!-- Exam Type -->
                    <div>
                        <label for="exam-type" class="block text-sm font-medium text-gray-300 mb-2">Exam Type</label>
                        <select id="exam-type" name="exam-type" class="w-full px-4 py-3 bg-gray-900 bg-opacity-70 border border-purple-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="Mains">JEE Mains</option>
                            <option value="Advanced">JEE Advanced</option>
                        </select>
                    </div>

                    <!-- Topic -->
                    <div>
                        <label for="topic" class="block text-sm font-medium text-gray-300 mb-2">Topic(s)</label>
                        <input type="text" id="topic" name="topic" required class="w-full px-4 py-3 bg-gray-900 bg-opacity-70 border border-purple-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., 'Kinematics', 'Organic Chemistry - GOC'">
                    </div>

                    <!-- Number of Results -->
                    <div>
                        <label for="num-results" class="block text-sm font-medium text-gray-300 mb-2">Number of Questions</label>
                        <input type="number" id="num-results" name="num-results" min="1" max="10" value="5" class="w-full px-4 py-3 bg-gray-900 bg-opacity-70 border border-purple-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., 5">
                    </div>

                    <!-- Search Button -->
                    <div>
                        <button type="submit" class="w-full px-8 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50">
                            Search
                        </button>
                    </div>
                </div>
            </form>

            <!-- Loading Indicator -->
            <div id="loading" class="hidden flex flex-col items-center justify-center py-12">
                <div class="spinner"></div>
                <p class="mt-4 text-purple-300">Finding questions...</p>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results" class="hidden p-8 bg-black bg-opacity-30 backdrop-blur-lg rounded-2xl shadow-2xl border border-purple-800 border-opacity-30">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-purple-300">Results</h2>
                <button id="back-to-search-btn" class="text-sm text-purple-300 hover:text-purple-100">&larr; New Search</button>
            </div>
            
            <div id="results-content" class="space-y-6">
                <!-- 
                  Generated text will go here.
                  Added 'whitespace-pre-wrap' to respect newlines and wrapping,
                  which is crucial for MathJax rendering.
                -->
                <div id="generated-text" class="p-6 bg-gray-900 bg-opacity-70 rounded-lg border border-purple-700 text-gray-200 whitespace-pre-wrap"></div>
                
                <!-- Uplifting Message -->
                <div id="uplifting-message" class="mt-8 pt-6 border-t border-purple-800 text-center">
                    <p class="text-lg text-purple-300 font-medium">
                        Great job on your search! Keep up the hard work. Your dedication is the key to success. You've got this! ðŸ’ª
                    </p>
                </div>

            </div>
        </section>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
        <div class="w-full max-w-md bg-[#1e1b2e] rounded-2xl shadow-2xl p-6 border border-purple-700">
            <h3 class="text-2xl font-bold text-red-400 mb-4">Error</h3>
            <p id="error-message" class="text-gray-300 mb-6">Something went wrong.</p>
            <button id="close-modal-btn" class="w-full px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500">
                Close
            </button>
        </div>
    </div>


    <script type="module">
        // --- Element Selection ---
        const landingPage = document.getElementById('landing');
        const searchPage = document.getElementById('search');
        const resultsPage = document.getElementById('results');
        
        const getStartedBtn = document.getElementById('get-started-btn');
        const backToLandingBtn = document.getElementById('back-to-landing-btn');
        const backToSearchBtn = document.getElementById('back-to-search-btn');

        const searchForm = document.getElementById('search-form');
        const searchFormContainer = document.querySelector('#search form');
        const loadingIndicator = document.getElementById('loading');
        
        const resultsContent = document.getElementById('results-content');
        const generatedTextEl = document.getElementById('generated-text');
        // Removed sourcesListEl

        const errorModal = document.getElementById('error-modal');
        const errorMessageEl = document.getElementById('error-message');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // --- Page Navigation ---
        getStartedBtn.addEventListener('click', () => {
            landingPage.classList.add('hidden');
            searchPage.classList.remove('hidden');
        });

        backToLandingBtn.addEventListener('click', () => {
            searchPage.classList.add('hidden');
            landingPage.classList.remove('hidden');
        });

        backToSearchBtn.addEventListener('click', () => {
            resultsPage.classList.add('hidden');
            searchPage.classList.remove('hidden');
            searchFormContainer.classList.remove('hidden');
        });

        // --- Modal Controls ---
        function showModal(message) {
            errorMessageEl.textContent = message;
            errorModal.classList.remove('hidden');
        }

        closeModalBtn.addEventListener('click', () => {
            errorModal.classList.add('hidden');
        });

        // --- API Call Logic ---
        const apiKey = "AIzaSyDLo7g0dt6bKuq8BOKEubBGlrXgNjfh-8Q"; // Leave empty for local testing / mock responses. Set your real key to call the API.
        // Build apiUrl only when apiKey is present to avoid broken requests during local testing.
        const apiUrl = apiKey ? `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}` : null;
        
        // Exponential backoff function
        async function fetchWithBackoff(url, options, retries = 5, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) {
                        return await response.json();
                    }
                    if (response.status === 429) { // Throttling
                        // console.warn(Throttled. Retrying in ${delay}ms...);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Increase delay
                    } else {
                        // Other error, don't retry
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    if (i === retries - 1) throw error; // Last retry failed
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }
        
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const examType = document.getElementById('exam-type').value;
            const topic = document.getElementById('topic').value;
            const numResults = document.getElementById('num-results').value;

            // Show loading, hide form
            searchFormContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');

            // --- Construct Prompts ---
            const userQuery = `Find ${numResults} JEE ${examType} previous year questions (PYQs) on the topic of "${topic}". Provide the question text.`;

            const systemPrompt = `You are a helpful assistant for JEE aspirants. Your task is to find previous year questions (PYQs) based on the user's request. 
- You MUST use Google Search to find this information.
- Present the questions clearly.
- Do not make up questions. If you cannot find questions, state that.`;
 
            // If no API key is configured, use a local mock so navigation and results UI can be tested.
            if (!apiKey || !apiUrl) {
                // Simulate network delay
                await new Promise(res => setTimeout(res, 800));
                const sample = `Sample PYQs â€” ${examType} â€” Topic: ${topic}\n\n` +
                    Array.from({ length: Math.max(1, Number(numResults)) }).map((_, i) =>
                        `${i + 1}. (Sample) Previous year question on ${topic} â€” [source: past papers]`
                    ).join('\n\n') +
                    `\n\nNote: This is a mock response because no API key is configured. Set apiKey in the script to call the real API.`;
 
                displayResults(sample);
                loadingIndicator.classList.add('hidden');
                return;
            }
 
            // --- Construct Payload for real API ---
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
 
            const fetchOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };
 
            try {
                const result = await fetchWithBackoff(apiUrl, fetchOptions);
                const candidate = result.candidates?.[0];
 
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    displayResults(text);
                } else {
                    console.error('Invalid API response:', result);
                    showModal('Could not find any results for this topic. Please try a different query.');
                    // Reveal form again so user can retry
                    searchFormContainer.classList.remove('hidden');
                }
 
            } catch (error) {
                console.error('Error fetching PYQs:', error);
                showModal('An error occurred while fetching data. Please check your connection and try again.');
                // Reveal form so user can retry
                searchFormContainer.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
         });

        // --- Display Logic ---
        function displayResults(generatedText) { // Removed 'sources' parameter
            // Clear previous results
            generatedTextEl.innerHTML = ''; // Use innerHTML to clear
            // Removed sourcesListEl.innerHTML = ''

            // --- UPDATE ---
            // Set text content directly. This is safer than innerHTML and works
            // with the 'whitespace-pre-wrap' class to render newlines.
            // This also ensures MathJax can parse the content as a single block,
            // preventing errors from splitting equations across <p> tags.
            generatedTextEl.textContent = generatedText;

            // Tell MathJax to typeset the new content
            if (window.MathJax) {
                window.MathJax.typesetPromise([generatedTextEl]).catch((err) => console.error('MathJax typeset error:', err));
            }

            // Removed all logic for populating sources

            // Show results page
            searchPage.classList.add('hidden');
            resultsPage.classList.remove('hidden');
        }

    </script>
</body>
</html>